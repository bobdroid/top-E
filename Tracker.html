<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="css.css">
</head>    
<body>
    <ul>
        <li><a href="index.html">Log uit</a></li>
        <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn">Historie</a>
            <div class="dropdown-content">
                <a href="historie/2024-07-18.html" class="historie-link" data-date="2024-07-18">2024-07-18.html</a>
                <a href="historie/2024-07-19.html" class="historie-link" data-date="2024-07-19">2024-07-19.html</a>
                <a href="historie/2024-07-20.html" class="historie-link" data-date="2024-07-20">2024-07-20.html</a>
                <a href="historie/2024-07-21.html" class="historie-link" data-date="2024-07-21">2024-07-21.html</a>
                <a href="historie/2024-07-22.html" class="historie-link" data-date="2024-07-22">2024-07-22.html</a>
                <a href="historie/2024-07-23.html" class="historie-link" data-date="2024-07-23">2024-07-23.html</a>
                <a href="historie/2024-07-24.html" class="historie-link" data-date="2024-07-24">2024-07-24.html</a>
                <a href="historie/2024-07-25.html" class="historie-link" data-date="2024-07-25">2024-07-25.html</a>
                <a href="historie/2024-07-26.html" class="historie-link" data-date="2024-07-26">2024-07-26.html</a>
                <a href="historie/2024-07-27.html" class="historie-link" data-date="2024-07-27">2024-07-27.html</a>
                <a href="historie/2024-07-28.html" class="historie-link" data-date="2024-07-28">2024-07-28.html</a>
                <a href="historie/2024-07-29.html" class="historie-link" data-date="2024-07-29">2024-07-29.html</a>
                <a href="historie/2024-07-30.html" class="historie-link" data-date="2024-07-30">2024-07-30.html</a>
                <a href="historie/2024-07-31.html" class="historie-link" data-date="2024-07-31">2024-07-31.html</a>
            </div>
        </li>
    </ul>
    
    <p class="hoeveelheidzegger">aantal:</p>

    <img src="img/profilepic.png" class="profilepicture">

    <label for="search" class="Invullenicon"> 
        <div>Voer hier in wat je hebt gegeten vandaag T6:</div>
    </label>
    <p>&nbsp;</p>

    <div id="container" style="display: none;">
        <div class="search-container">
            <input type="text" id="search-1" class="search-box" list="suggestions" placeholder="Typ om te zoeken...">
            <datalist id="suggestions">
                <option value="Kipdijfiletstuk">
                <option value="kipvleugel">
                <option value="Cherry">
                <option value="Date">
                <option value="Elderberry">
                <option value="Fig">
                <option value="Grape">
                <option value="Honeydew">
            </datalist>
            <input type="number" id="hoeveelheid-1" class="hoeveelheidbox" placeholder="Hoeveelheid">
            <p id="valuedisplay-1" class="value-display"></p>
        </div>
    </div>
    
    <!-- Knop om inputvelden te kopiëren -->
    <button onclick="kopieerInputvelden()">Kopieer inputvelden</button>
    <!-- Knop om de gegevens te downloaden -->
    <button onclick="downloadData()">Download Gegevens</button>

    <p id="totaal" class="totaalclass"></p>
    <p id="nodig" class="nodig"></p>
    
    <script>
        const suggestionData = {
            "Kipdijfiletstuk": 6,
            "kipvleugel": 20,
            "Cherry": 10,
            "Date": 15,
            "Elderberry": 20,
            "Fig": 25,
            "Grape": 30,
            "Honeydew": 35
        };

        let kopieTeller = 0; // Teller voor het bijhouden van het aantal kopieën
        let isFirstCloneAdded = false; // Flag om bij te houden of de eerste clone is toegevoegd

        // Functie om value display bij te werken
        function updateValueDisplay(searchInput, hoeveelheidInput, valueDisplay) {
            const zoekterm = searchInput.value.trim().toLowerCase();
            const hoeveelheid = parseInt(hoeveelheidInput.value.trim());

            let totaleWaarde = 0;

            if (zoekterm && hoeveelheid) {
                // Zoekterm matchen met suggestionData
                for (const item in suggestionData) {
                    if (item.toLowerCase().includes(zoekterm)) {
                        totaleWaarde += suggestionData[item] * hoeveelheid;
                    }
                }
            }

            valueDisplay.textContent = `${totaleWaarde} gram`;

            // Update ook het totaal onderaan de pagina
            updateTotalValueDisplay();
        }

        
    

        // Functie om inputvelden te kopiëren
        function kopieerInputvelden() {
            const container = document.getElementById('container');
            container.style.display = 'block'; // Zorg ervoor dat de container zichtbaar wordt

            const originalContainer = document.querySelector('.search-container');

            if (!isFirstCloneAdded) {
                // Voeg de eerste clone toe op de plaats van de originele container
                addFirstClone(originalContainer);
                isFirstCloneAdded = true;
            }

            const numCopies = 1; // Aantal kopieën dat je wilt maken

            for (let i = 0; i < numCopies; i++) {
                const newContainer = document.createElement('div');
                newContainer.className = 'search-container';
                newContainer.innerHTML = originalContainer.innerHTML;
                newContainer.style.marginTop = `${(kopieTeller + i + 1) * 150}px`; // Verhoog de margin per kopie

                // Genereer unieke id's voor de gekopieerde inputvelden
                const newSearchId = `search-${kopieTeller + i + 1}`;
                const newHoeveelheidId = `hoeveelheid-${kopieTeller + i + 1}`;
                const newValueDisplayId = `valuedisplay-${kopieTeller + i + 1}`;

                // Update id's van inputvelden en value display
                const newSearchInput = newContainer.querySelector('.search-box');
                const newHoeveelheidInput = newContainer.querySelector('.hoeveelheidbox');
                const newValueDisplay = newContainer.querySelector('.value-display');

                newSearchInput.setAttribute('id', newSearchId);
                newHoeveelheidInput.setAttribute('id', newHoeveelheidId);
                newValueDisplay.setAttribute('id', newValueDisplayId);

                // Voeg event listeners toe voor input velden om de waarde direct bij te werken
                newSearchInput.addEventListener('input', function() {
                    updateValueDisplay(newSearchInput, newHoeveelheidInput, newValueDisplay);
                });

                newHoeveelheidInput.addEventListener('input', function() {
                    updateValueDisplay(newSearchInput, newHoeveelheidInput, newValueDisplay);
                });

                // Voeg gekopieerde container toe aan de hoofdcontainer
                container.appendChild(newContainer);
            }

            // Verberg de originele container na het kopiëren
            originalContainer.style.display = 'none';

            kopieTeller += numCopies;

            // Update het totaal onderaan de pagina na het kopiëren
            updateTotalValueDisplay();
        }

        // Functie om de eerste clone toe te voegen op de plek van de originele container
        function addFirstClone(originalContainer) {
            const newContainer = document.createElement('div');
            newContainer.className = 'search-container';
            newContainer.innerHTML = originalContainer.innerHTML;

            // Genereer unieke id's voor de gekopieerde inputvelden
            const newSearchId = `search-${kopieTeller + 1}`;
            const newHoeveelheidId = `hoeveelheid-${kopieTeller + 1}`;
            const newValueDisplayId = `valuedisplay-${kopieTeller + 1}`;

            // Update id's van inputvelden en value display
            const newSearchInput = newContainer.querySelector('.search-box');
            const newHoeveelheidInput = newContainer.querySelector('.hoeveelheidbox');
            const newValueDisplay = newContainer.querySelector('.value-display');

            newSearchInput.setAttribute('id', newSearchId);
            newHoeveelheidInput.setAttribute('id', newHoeveelheidId);
            newValueDisplay.setAttribute('id', newValueDisplayId);

            // Voeg event listeners toe voor input velden om de waarde direct bij te werken
            newSearchInput.addEventListener('input', function() {
                updateValueDisplay(newSearchInput, newHoeveelheidInput, newValueDisplay);
            });

            newHoeveelheidInput.addEventListener('input', function() {
                updateValueDisplay(newSearchInput, newHoeveelheidInput, newValueDisplay);
            });

            // Voeg gekopieerde container toe aan de hoofdcontainer
            document.getElementById('container').appendChild(newContainer);
        }

        // Functie om totaalwaarde van alle value displays te berekenen en weer te geven
        function updateTotalValueDisplay() {
            let totalValue = 0;
            const allValueDisplays = document.querySelectorAll('.value-display');

            allValueDisplays.forEach(display => {
                const valueText = display.textContent;
                const match = valueText.match(/\d+/); // Zoek naar getallen in de tekst
                if (match) {
                    totalValue += parseInt(match[0]);
                }
            });

            const totalDisplay = document.getElementById('totaal');
            totalDisplay.textContent = `Totaal: ${totalValue} gram`;

            updateNodigValue(totalValue);
        }

        // Functie om de 'nodig' waarde te berekenen en weer te geven
        function updateNodigValue(totalValue) {
            const nodig = 106 - totalValue;
            let scoops = Math.round(nodig / 20);

            // Controleer of scoops 0 of negatief is en corrigeer indien nodig
            if (scoops <= 0) {
                scoops = 1; // Stel scoops in op minimaal 1 als het 0 of negatief is
            }
            const nodigDisplay = document.getElementById('nodig');
            nodigDisplay.textContent = `nodig: ${nodig} gram/${scoops} scoops `;
        }

        // Functie om de ingevulde gegevens te exporteren naar een HTML-bestand
       // Functie om de ingevulde gegevens te exporteren naar een HTML-bestand
       function downloadData() {
    // Selecteer alle invoervelden en displays
    const allSearchInputs = document.querySelectorAll('.search-box');
    const allHoeveelheidInputs = document.querySelectorAll('.hoeveelheidbox');
    const allValueDisplays = document.querySelectorAll('.value-display');

    // Begin met de HTML-structuur inclusief CSS-link
    let data = `<!DOCTYPE html>
<html>
<head>
    <title>Mijn Tracker</title>
    <link rel="stylesheet" href="css.css">
</head>
<body>\n`;

    let totalValue = 0;

    // Voeg navigatiebalk toe
    data += `<ul>
        <li><a href="index.html">Log uit</a></li>
        <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn">Historie</a>
            <div class="dropdown-content">
`;

    // Voeg historie links toe
    const startDate = new Date('2024-07-18');
    const endDate = new Date('2024-07-31');
    const today = new Date();

    for (let date = startDate; date <= endDate; date.setDate(date.getDate() + 1)) {
        const dateString = date.toISOString().split('T')[0];
        const displayDate = `${date.getFullYear()}-${('0' + (date.getMonth() + 1)).slice(-2)}-${('0' + date.getDate()).slice(-2)}`;
        
        if (date <= today) {
            data += `<a href="historie/${dateString}.html" class="historie-link" data-date="${displayDate}">${displayDate}.html</a>\n`;
        }
    }

    data += `           </div>
        </li>
    </ul>\n`;

    // Loop door alle invoervelden en displays
    for (let i = 0; i < allSearchInputs.length; i++) {
        const searchValue = allSearchInputs[i].value;
        const hoeveelheidValue = allHoeveelheidInputs[i].value;
        const displayValue = allValueDisplays[i].textContent;

        // Controleer of er gegevens zijn ingevuld
        if (searchValue || hoeveelheidValue) {
            // Bereken totale waarde indien mogelijk
            const match = displayValue.match(/\d+/);
            if (match) {
                totalValue += parseInt(match[0]);
            }
            // Voeg ingevulde gegevens toe aan de HTML
            data += `<p>${searchValue}, Hoeveelheid: ${hoeveelheidValue}, Totale waarde: ${displayValue}</p>\n`;
        }
    }

    // Voeg bericht toe als er geen gegevens zijn ingevuld
    if (data === `<!DOCTYPE html>\n<html>\n<head>\n    <title>Mijn Tracker</title>\n    <link rel="stylesheet" type="text/css" href="css.css">\n</head>\n<body>\n`) {
        data += '<p>Geen gegevens ingevuld.</p>\n';
    }

    // Voeg totaalwaarde toe
    data += `\n<p>Totaal: ${totalValue} gram</p>\n`;

    // Voeg link toe naar tracker.html
    data += '<a href="tracker.html">Ga naar Tracker</a>\n';

    // Sluit de HTML-structuur af
    data += '</body>\n</html>';

    // Roep de functie aan om HTML te downloaden
    downloadHTML(data);
}


function downloadHTML(htmlContent) {
    const blob = new Blob([htmlContent], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    
    // Huidige datum als bestandsnaam
    const currentDate = new Date();
    const formattedDate = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
    a.download = `${formattedDate}.html`;

    a.href = url;
    a.style.display = 'none'; // Verberg de link op de pagina
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}





    </script>
</body>
</html>
